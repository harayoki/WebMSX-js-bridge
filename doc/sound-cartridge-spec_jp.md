# サウンドROMカートリッジ仕様（ドラフト）

## 概要

本ドキュメントは、MP3やWAVなどの外部圧縮音声ファイルを利用し、リッチなオーディオ（BGM／SE）を再生する **MSX向けサウンドROMカートリッジ** を提案します。

カートリッジは **MSXのI/Oポート** で制御され、以下の両方で動作することを想定しています:
- エミュレータ（例: I/Oブリッジを備えたWebMSX）
- 将来的な実機MSXハードウェア

MSX OSの改造やネットワーク機能に頼らず、MSXのオーディオ能力を拡張することを目指します。

---

## 設計目標

- 高品質なストリーミング音声（BGM重視）を提供
- MSX側コードをシンプルかつ移植性の高いままに保つ
- MSXスタイルのI/Oポート制御を採用
- 外部音声とMSX標準の音声出力をミックス
- エミュレータと将来の実機ハードの両対応を視野に入れる

---

## ハードウェア構成

### オーディオデコーダ

- 次のいずれか:
  - 専用の **MP3デコーダIC**
  - MCUによる内蔵またはソフトウェアベースのMP3/WAVデコード
- 最低限の対応フォーマット:
  - MP3
  - WAV（PCM）
- 将来のオプション対応:
  - OGG
  - ADPCM系

---

### ストレージ

- カートリッジ上のストレージ例:
  - フラッシュメモリ
  - microSDカード
- 音声アセットの格納:
  - BGMトラック
  - 効果音
- ファイルシステム:
  - シンプルなフラット構造
  - ID→ファイルのインデックス参照が望ましい

---

### 音声出力

- デコードした音声をMSXの音声出力にミックス
- ミックス方法:
  - SCCスタイルのアナログミックス
  - 外部DAC + アナログミキサー
- ミックス後の出力をMSXのオーディオ経路へ供給

---

## 制御インターフェース

### I/Oポートアクセス

- MSXはI/Oポート経由でカートリッジを制御
- 典型的なコマンド:
  - 再生
  - 停止
  - 一時停止
  - ループ有効 / 無効
  - 音量調整
  - フェードイン / フェードアウト
- コマンドはファイル名ではなくIDで音声を参照

---

### 再生チャンネル

- **BGMチャンネル**
  - 長尺・ループ再生向け
  - フェードやループ制御が推奨
- **SEチャンネル（任意）**
  - 短いワンショット向け
  - ハードウェア簡素化のため省略可能
  - SEはMSX PSGで代替してもよい

最小構成では **BGMのみ** に絞ってもよい。

---

## 再生機能

- ループ制御
  - 無限ループ
  - ループ回数指定
- フェード制御
  - フェードイン
  - フェードアウト
  - 時間調整可能
- 独立制御項目:
  - BGM再生状態
  - 音量

---

## 想定ユースケース

- MSX1クラス機でのリッチなBGM
- PSG/SCCの制約を超えるゲームサウンドトラック
- エミュレータとハードウェアで共通動作するオーディオ挙動
- ハイブリッド構成例:
  - 効果音はPSG
  - BGMはカートリッジ

---

## エミュレータ互換性

- エミュレータでは:
  - I/Oポートコマンドをインターセプト
  - ホスト（例: JavaScript）が音声再生を担当
- MSXソフト側は無変更で利用可能
- 同一のI/Oプロトコルをハードウェア実装にも流用可能

---

## 設計思想

- カートリッジを **外部サウンドデバイス** として扱う
- MSXソフトにWebやホスト依存のロジックを埋め込まない
- 実機化の可能性を残す
- 複雑さよりシンプルさと将来互換性を優先

---

## まとめ

このサウンドROMカートリッジは、デコードとストレージを専用ハードウェアにオフロードし、I/Oポート経由で完全に制御されることでMSXのオーディオ能力を拡張します。MSXロジックと外部機能を明確に分離する設計により、エミュレータと実機の両実装を視野に入れた柔軟な音声拡張を実現します。
